function iSlider(b){this.opts={wrap:".wrap",item:".item",playClass:"play",index:0,noslide:[],speed:400,triggerDist:30,isVertical:true,useACC:true,fullScr:true,preventMove:false,lastLocate:true,loadingImgs:[],onslide:function(c){},onloading:function(c,d){},loadingOverTime:15};for(var a in b){this.opts[a]=b[a]}this.init()}iSlider.prototype={wrap:null,index:0,length:0,_tpl:[],_delayTime:150,_sessionKey:location.host+location.pathname,_prev:null,_current:null,_next:null,$:function(b,a){return(a||document).querySelector(b)},addClass:function(b,a){if(b.classList){b.classList.add(a)}else{b.className+=" "+a}},removeClass:function(b,a){if(b.classList){b.classList.remove(a)}else{b.className=b.className.replace(new RegExp("\\s*\\b"+a+"\\b","g"),"")}},init:function(){var a=this;this.wrap=typeof this.opts.wrap=="string"?this.$(this.opts.wrap):this.opts.wrap;this._sessionKey=btoa(encodeURIComponent(this._sessionKey+this.wrap.id+this.wrap.className));var d=parseInt(sessionStorage[this._sessionKey]);this.index=((this.opts.lastLocate&&d>=0)?d:0)||this.opts.index||0;if(!this.wrap){throw Error('"wrap" param can not be empty!');return}this._tpl=this.wrap.cloneNode(true);this._tpl=this.opts.item?this._tpl.querySelectorAll(this.opts.item):this._tpl.children;for(var b=0;b<this._tpl.length;b++){this._tpl[b].style.cssText+="display:block;position:absolute;left:0;top:0;width:100%;height:100%"}this.length=this._tpl.length;this.touchInitPos=0;this.startPos=0;this.totalDist=0,this.deltaX1=0;this.deltaX2=0;if(this.opts.fullScr){var c=document.createElement("style");c.innerHTML="html,body{width:100%;height:100%;overflow:hidden}";document.head.appendChild(c);c=null}this.wrap.style.cssText+="display:block;position:relative;"+(this.opts.fullScr?"width:100%;height:100%":"");this.displayWidth=this.wrap.clientWidth;this.displayHeight=this.wrap.clientHeight;this.scrollDist=this.opts.isVertical?this.displayHeight:this.displayWidth;this._setHTML();if(this.opts.loadingImgs&&this.opts.loadingImgs.length){this._loading()}else{this._pageInit()}if(/iPhone|iPod|iPad/.test(navigator.userAgent)){this._delayTime=50}this._bindEvt()},_bindEvt:function(){var b=this;var a=this.opts.fullScr?this.$("body"):this.wrap;a.addEventListener("touchstart",function(c){b._touchstart(c)},false);a.addEventListener("touchmove",function(c){b._touchmove(c)},false);a.addEventListener("touchend",function(c){b._touchend(c)},false);a.addEventListener("touchcancel",function(c){b._touchend(c)},false);if(this.opts.fullScr||this.opts.preventMove){a.addEventListener("touchmove",function(c){c.preventDefault()},false)}},_setHTML:function(b){if(b>=0){this.index=parseInt(b)}this.wrap.innerHTML="";var a=document.createDocumentFragment();if(this.index>0){this._prev=this._tpl[this.index-1].cloneNode(true);this._prev.style.cssText+=this._getTransform("-"+this.scrollDist+"px");a.appendChild(this._prev)}else{this._prev=null}this._current=this._tpl[this.index].cloneNode(true);this._current.style.cssText+=this._getTransform(0);a.appendChild(this._current);if(this.index<this.length-1){this._next=this._tpl[this.index+1].cloneNode(true);this._next.style.cssText+=this._getTransform(this.scrollDist+"px");a.appendChild(this._next)}else{this._next=null}this.wrap.appendChild(a)},_pageInit:function(){var a=this;setTimeout(function(){a.addClass(a._current,a.opts.playClass);try{a.opts.onslide.call(a,a.index)}catch(b){console.info(b)}},this._delayTime)},_touchstart:function(b){var a=this;if(b.touches.length!==1){return}this.lockSlide=false;this._touchstartX=b.touches[0].pageX;this._touchstartY=b.touches[0].pageY;this.touchInitPos=this.opts.isVertical?b.touches[0].pageY:b.touches[0].pageX;this.deltaX1=this.touchInitPos;this.startPos=0;this.startPosPrev=-this.scrollDist;this.startPosNext=this.scrollDist;if(this._next){a._next.style.cssText+="-webkit-transition-duration:0;"}a._current.style.cssText+="-webkit-transition-duration:0;";if(this._prev){a._prev.style.cssText+="-webkit-transition-duration:0;"}},_touchmove:function(g){var c=g.target;do{c=c.parentNode}while(c!=this.wrap);if(!c&&g.target!=this.wrap){return}var b=this;if(g.touches.length!==1||this.lockSlide){return}var f=Math.abs(g.touches[0].pageX-this._touchstartX);var d=Math.abs(g.touches[0].pageY-this._touchstartY);if(f>d&&this.opts.isVertical){this.lockSlide=true;return}else{if(f<d&&!this.opts.isVertical){this.lockSlide=true;return}}if(this.opts.noslide&&this.opts.noslide.indexOf(this.index)>=0&&g.touches[0].pageY-this._touchstartY<0){return}var a=this.opts.isVertical?g.touches[0].pageY:g.touches[0].pageX;this.deltaX2=a-this.deltaX1;this.totalDist=this.startPos+a-this.touchInitPos;b._current.style.cssText+=this._getTransform(this.totalDist+"px");this.startPos=this.totalDist;if(this.totalDist<0){if(this._next){this.totalDist2=this.startPosNext+a-this.touchInitPos;b._next.style.cssText+=this._getTransform(this.totalDist2+"px");this.startPosNext=this.totalDist2}}else{if(this._prev){this.totalDist2=this.startPosPrev+a-this.touchInitPos;b._prev.style.cssText+=this._getTransform(this.totalDist2+"px");
this.startPosPrev=this.totalDist2}}this.touchInitPos=a},_touchend:function(a){if(this.deltaX2<-this.opts.triggerDist){this.next()}else{if(this.deltaX2>this.opts.triggerDist){this.prev()}else{this._itemReset()}}this.deltaX2=0},_getTransform:function(a){var b=this.opts.isVertical?"0,"+a:a+",0";return";-webkit-transform:"+(this.opts.useACC?"translate3d("+b+",0)":"translate("+b+")")},_itemReset:function(){var a=this;a._current.style.cssText+="-webkit-transition-duration:"+this.opts.speed+"ms;"+this._getTransform(0);if(a._prev){a._prev.style.cssText+="-webkit-transition-duration:"+this.opts.speed+"ms;"+this._getTransform("-"+this.scrollDist+"px")}if(a._next){a._next.style.cssText+="-webkit-transition-duration:"+this.opts.speed+"ms;"+this._getTransform(this.scrollDist+"px")}this.deltaX2=0},_loading:function(){var k=this;var a=this.opts.loadingImgs;var g=setTimeout(function(){try{k.opts.onloading.call(k,j,j)}catch(i){}k._pageInit()},this.opts.loadingOverTime*1000);var f=[],d=1;var j=a.length+1;for(var c=0;c<a.length;c++){f[c]=new Image();f[c].src=a[c];f[c].onload=f[c].onerror=f[c].onabort=function(i){d++;if(this.src===a[0]&&i.type==="load"){clearTimeout(g)}b();this.onload=this.onerror=this.onabort=null}}try{k.opts.onloading.call(k,1,j)}catch(h){}function b(){try{k.opts.onloading.call(k,d,j)}catch(i){}if(d==j){if(g){clearTimeout(g)}k._pageInit();f=null;if(k.opts.preLoadingImgs&&k.opts.preLoadingImgs.length){k.preloading()}}}},prev:function(){var a=this;if(!this._current||!this._prev){this._itemReset();return}if(this.index>0){this.index--}else{this._itemReset();return false}if(this._next){this.wrap.removeChild(this._next)}this._next=this._current;this._current=this._prev;this._prev=null;this._next.style.cssText+="-webkit-transition-duration:"+this.opts.speed+"ms;"+this._getTransform(this.scrollDist+"px");this._current.style.cssText+="-webkit-transition-duration:"+this.opts.speed+"ms;"+this._getTransform(0);sessionStorage[this._sessionKey]=this.index;setTimeout(function(){if(a.$("."+a.opts.playClass,a.wrap)){a.removeClass(a.$("."+a.opts.playClass,a.wrap),a.opts.playClass)}a.addClass(a._current,a.opts.playClass);try{a.opts.onslide.call(a,a.index)}catch(c){console.info(c)}var b=a.index-1;if(b<0){b=a.length-1;return false}a._prev=a._tpl[b].cloneNode(true);a._prev.style.cssText+="-webkit-transition-duration:0ms;"+a._getTransform("-"+a.scrollDist+"px");a.wrap.insertBefore(a._prev,a._current)},this._delayTime)},next:function(){var a=this;if(!this._current||!this._next){this._itemReset();return}if(this.index<this.length-1){this.index++}else{this._itemReset();return false}if(this._prev){this.wrap.removeChild(this._prev)}this._prev=this._current;this._current=this._next;this._next=null;this._prev.style.cssText+="-webkit-transition-duration:"+this.opts.speed+"ms;"+this._getTransform("-"+this.scrollDist+"px");this._current.style.cssText+="-webkit-transition-duration:"+this.opts.speed+"ms;"+this._getTransform(0);sessionStorage[this._sessionKey]=this.index;setTimeout(function(){if(a.$("."+a.opts.playClass,a.wrap)){a.removeClass(a.$("."+a.opts.playClass,a.wrap),a.opts.playClass)}a.addClass(a._current,a.opts.playClass);try{a.opts.onslide.call(a,a.index)}catch(c){console.info(c)}var b=a.index+1;if(b>=a.length){return false}a._next=a._tpl[b].cloneNode(true);a._next.style.cssText+="-webkit-transition-duration:0ms;"+a._getTransform(a.scrollDist+"px");a.wrap.appendChild(a._next)},this._delayTime)},slideTo:function(a){this._setHTML(a);this._pageInit()}};if(typeof module=="object"){module.exports=iSlider}else{window.iSlider=iSlider};